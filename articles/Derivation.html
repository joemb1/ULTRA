<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Procedure • ultra</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Procedure">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">ultra</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/ultra.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/Derivation.html">Procedure</a></li>
    <li><a class="dropdown-item" href="../articles/Vignette.html">my-vignette</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Procedure</h1>
                        <h4 data-toc-skip class="author">Joe Butler</h4>
            
            <h4 data-toc-skip class="date">2024-10-28</h4>
      

      <div class="d-none name"><code>Derivation.Rmd</code></div>
    </div>

    
    
<style type="text/css">
.main-container {
  max-width: 768px;
  margin-left: auto;
  margin-right: auto;
}
  .nowrap {
    #white-space: nowrap;
    font-size: 19px; 
    -moz-hyphens: none;
    -ms-hyphens: none;
    -webkit-hyphens: none;
    hyphens: none;
  }
</style>
<div class="section level2">
<h2 id="selection-of-critical-feature-set">1) Selection of critical feature set<a class="anchor" aria-label="anchor" href="#selection-of-critical-feature-set"></a>
</h2>
<br><div class="nowrap">
<p>A univariate logistic regression is performed separately for every
feature <em>f</em> (<em>f</em> = 1, …, total number of features):</p>
</div>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mtext mathvariant="normal">case</mtext><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mfrac><mn>1</mn><mrow><mn>1</mn><mo>+</mo><mo>exp</mo><mrow><mo stretchy="true" form="prefix">(</mo><mo>−</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>α</mi><mo>+</mo><msub><mi>β</mi><mi>f</mi></msub><msub><mi>z</mi><mrow><mi>f</mi><mo>,</mo><mi>i</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow></mrow></mfrac></mrow><annotation encoding="application/x-tex">
P(\text{case}_i) = \frac{1}{1 + \exp\left(-(\alpha + \beta_f z_{f,i})\right)}
</annotation></semantics></math><br></p>
<div class="nowrap">
<p>where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>z</mi><mi>f</mi></msub><annotation encoding="application/x-tex">z_f</annotation></semantics></math>
is the vector of z-score scaled values for feature <em>f</em>, and
<em>α</em> (intercept) and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>𝛽</mi><mi>f</mi></msub><annotation encoding="application/x-tex">𝛽_f</annotation></semantics></math>
are the estimated parameters. This is performed for all features
seperately, and then the features are ordered by their univariate area
under the receiver operating characteristic curve (AUROC) or p-value
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>H</mi><mn>0</mn></msub><annotation encoding="application/x-tex">H_0</annotation></semantics></math>:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>𝛽</mi><mi>f</mi></msub><annotation encoding="application/x-tex">𝛽_f</annotation></semantics></math>
= 0). <br><br> Next let <em>C</em> represent the set of the <em>c</em>
most discriminative genes (i.e. the top <em>c</em> features after
ordering), then for patient <em>i</em> the classifier score is the sum
of the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>𝛽</mi><mi>f</mi></msub><annotation encoding="application/x-tex">𝛽_f</annotation></semantics></math><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>z</mi><mrow><mi>f</mi><mo>,</mo><mi>i</mi></mrow></msub><annotation encoding="application/x-tex">z_{f,i}</annotation></semantics></math>
values calculated over these <em>c</em> features:</p>
</div>
<br><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mtext mathvariant="normal">score</mtext><mi>i</mi></msub><mo>=</mo><munder><mo>∑</mo><mrow><mi>f</mi><mo>∈</mo><mi>C</mi></mrow></munder><msub><mi>β</mi><mi>f</mi></msub><msub><mi>z</mi><mrow><mi>f</mi><mo>,</mo><mi>i</mi></mrow></msub></mrow><annotation encoding="application/x-tex">
\text{score}_i = \sum_{f \in C} \beta_f z_{f,i}
</annotation></semantics></math><br><div class="nowrap">
<p>This function is essentially a prediction model to which various
classification metrics (e.g. AUROC(case ~ score), MCC etc) can be
applied to assess performance for each model size <em>c</em>. A critical
feature set
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>c</mi><mrow><mi>c</mi><mi>r</mi><mi>i</mi><mi>t</mi></mrow></msub><annotation encoding="application/x-tex">c_{crit}</annotation></semantics></math>
is defined as the subset of features that maximizes the chosen metric
across all values of <em>c</em> (i.e the gloabal maximum). It is
generally observed that as features are added from 1 to
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>c</mi><mrow><mi>c</mi><mi>r</mi><mi>i</mi><mi>t</mi></mrow></msub><annotation encoding="application/x-tex">c_{crit}</annotation></semantics></math>
the predictive performance improves; thus the critical feature set can
be construed as the “signal”. After
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>c</mi><mrow><mi>c</mi><mi>r</mi><mi>i</mi><mi>t</mi></mrow></msub><annotation encoding="application/x-tex">c_{crit}</annotation></semantics></math>
adding more features to the model generally leads to a decrease in
predictive performance; thus this set of features may be construed as
“noise”. <br><br> Note if predicted probabilities are required from the
critical feature set model then Platt scaling (logistic regression) is
applied to the scores: <br></p>
</div>
<p><br><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mtext mathvariant="normal">case</mtext><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mfrac><mn>1</mn><mrow><mn>1</mn><mo>+</mo><mo>exp</mo><mrow><mo stretchy="true" form="prefix">(</mo><mo>−</mo><mo stretchy="false" form="prefix">(</mo><mi>a</mi><mo>+</mo><mi>b</mi><msub><mtext mathvariant="normal">.score</mtext><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow></mfrac></mrow><annotation encoding="application/x-tex">
P(\text{case}_i) = \frac{1}{1 + \exp\left(-(a + b\text{.score}_i \right)}
</annotation></semantics></math><br></p>
</div>
<div class="section level2">
<h2 id="selection-of-minimal-feature-set">2) Selection of minimal feature set<a class="anchor" aria-label="anchor" href="#selection-of-minimal-feature-set"></a>
</h2>
<br><div class="nowrap">
<p>Within the critical set there may be features with redundant
information (i.e correlated features). To address this issue we seek a
minimal set of informative features from the critical set defined
above.</p>
<p>Beginning with an intercept-only model we assess if adding features
consecutively improves predictive improvement. First the most
discriminative feature (top of the ordered feature list) is used to
contruct the model (as above), if this is sufficiently better than the
intercept-only model then this feature is included in the minimal
feature set. If the feature does not sufficiently improve the model it
is excluded. Then the next most discriminative feature is considered,
provisionally including it to the minimal set and assessing if the model
is improved, including or excluding accordingly. This is iterated over
all features in the critical set defined above.</p>
<p>To assess model improvement metrics like LRT p-value or fraction of
new information can be used (see
<a href="https://www.fharrell.com/post/addvalue/" target="_blank" rel="noopener noreferrer" class="external-link">Frank
Harrel</a>). For both these methods the classifier score is converted to
a probability using Platt scaling.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Joe Butler.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
